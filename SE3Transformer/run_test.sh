#!/bin/bash
export PATH=/memory_profiler/memprof/bin:$PATH
export OMP_NUM_THREADS=2
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo "Checking GPU!"
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo ""
echo ""
nvidia-smi
nvcc --version

echo ""
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo "Launching GPUSTAT!"
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo ""
echo ""
gpustat -a -i 60 > gpustat.log 2>&1 &
echo ""
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo "Training!"
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo ""
echo ""
time memprof.sh bash scripts/benchmark_train.sh 24 &
PID=$!
echo "PID: $PID"
wait $PID
echo ""
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo "Inference Performance Benchmark!"
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo ""
echo ""
time memprof.sh bash scripts/benchmark_inference.sh 24 &
PID=$!
echo "PID: $PID"
wait $PID
echo ""
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo "Benchmark End!"
echo "---------------------------------------------------------------------------------------------------------------------------------------------"
echo ""

